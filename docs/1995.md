# SQL 中的触发器是什么，如何实现？

> 原文:[https://www.edureka.co/blog/triggers-in-sql/](https://www.edureka.co/blog/triggers-in-sql/)

[SQL](https://www.edureka.co/mysql-dba) 中的触发器是一个过程代码，在响应指定表上的某些事件时自动执行。理解这些小代码如何对数据库性能产生如此巨大的影响是很重要的。在这篇文章中，你将通过例子学习如何实现触发器。

本文将涵盖以下主题:

*   [什么是触发器？T3】](#trigger)
*   [语法及示例](#syntax)
*   [操作中触发](#operations)
*   [优势与劣势](#advantage)

## **什么是触发器？**

触发器是自动执行的 [SQL](https://en.wikipedia.org/wiki/SQL) 代码 以响应特定表上的特定事件。这些用于维护数据的完整性。 [SQL](https://www.edureka.co/blog/sql-basics/) 中的触发器的工作方式类似于真实世界中的触发器。例如，当枪的扳机被拉动时，子弹被发射。我们都知道这一点，但是这与 SQL 中的触发器有什么关系呢？为了理解这一点，让我们考虑一个假设的情况。

![Trigger - Triggers in SQL - Edureka](../Images/a467e5af46397e915a138358b5a8e463.png)T2】

约翰是一家公司的营销人员。当一个新客户的数据被输入公司的数据库时，他必须向每个新客户发送欢迎信息。如果是一个或两个客户，John 可以手动完成，但如果数量超过 1000，该怎么办？在这种情况下，触发器就派上用场了。

因此，现在 John 可以轻松地创建一个触发器，一旦新客户的数据被输入数据库，该触发器就会自动向他们发送一封欢迎电子邮件。所以我希望你清楚 SQL 中触发器的引入。

请始终记住，对于一个表，不能有两个动作时间和事件相似的触发器。例如，我们不能在更新 前有两个 触发器用于一个表。但是我们可以在更新 之前有一个 *，在插入* 触发器之前有一个 *，或者在更新* 之前有一个 *，在更新* 触发器之后有一个 *。*

在我们深入触发器的基础知识之前，我建议你理解一下 [SQL 基础知识](https://www.edureka.co/blog/sql-tutorial/)和[规范化](https://www.edureka.co/blog/normalization-in-sql/)的概念，这样你就能更好地掌握 SQL 中的触发器。

**语法及示例**

现在让我们看看触发器的语法。

```
Create Trigger Trigger_Name
(Before | After)  [ Insert | Update | Delete]
on [Table_Name]
[ for each row | for each column ]
[ trigger_body ]
```

现在让我分解这个语法并详细解释每一部分。

*   ***创建触发器*** 这两个关键字用来指定一个触发器块将要被声明。
*   ***触发器 _ 名称*** 它指定了触发器的名称。触发器名称必须是唯一的，并且不能重复。
*   **(** ***前|后*** **)** 这指定了触发器将在什么时候被执行。它告诉我们触发的时间，即，在正在进行的事件之前或之后。

*   *Before 触发器*用于在记录值保存到数据库之前更新或验证记录值。
*   *After 触发器*用于访问系统设置的字段值，并影响其他记录的变化。激活 after 触发器的记录是只读的。如果要更新记录，我们不能使用 After 触发器，因为它会导致只读错误。
*   **[** ***插入|更新|删除*** **]** 这些是 DML 操作，我们可以在给定的触发器中使用它们中的任何一个。
*   ***on*****[*****Table _ Name*****]**我们需要提到触发器所应用的表名。不要忘记在 关键字上使用 **，并确保所选的表格存在于数据库中。**
*   **【每行|每列】**

*   **[*****【trigger _ body】***由调用触发器时需要执行的查询组成。

所以这只是一个简单的导火索。但是我们也可以创建一个嵌套的触发器来完成多进程。此外，在适当的时候处理并终止它是非常重要的。如果我们不正确地结束触发器，它可能会导致一个无限循环。

您可能想知道在什么情况下我们可以使用嵌套触发器。与其给你一个量身定做的答案，不如让我与你分享一个场景，这将有助于你更好地理解嵌套触发器。从前面的场景继续，John 为添加到公司数据库中的每个新客户发送一封电子邮件。现在，如果他希望跟踪收到电子邮件的客户数量，该怎么办呢？现在，John 需要创建一个嵌套触发器，以便在发送电子邮件的同时跟踪计数。

以上是关于触发器语法的所有内容，现在让我们尝试在 SQL 中实现一个触发器示例。

**触发器示例:**

在下面的触发器中，一旦学生的详细信息被更新到数据库中，我们就试图计算该学生的百分比。

```
CREATE TRIGGER sample_trigger
before INSERT
ON student
FOR EACH ROW
SET new.total = new.marks/6;
```

这里的" **NEW"** 关键字指的是受到影响的行。

## **触发器中的操作**

我们可以使用触发器执行许多操作。有些可能很简单，有些可能有点复杂，但是一旦我们通过查询就很容易理解了。

*   **放下扳机**

```
DROP TRIGGER trigger name;
```

*   **显示一个触发器**

下面的代码将显示所有存在的触发器。

```
SHOW TRIGGERS;
```

下面的代码将显示特定数据库中存在的所有触发器。

```
SHOW TRIGGERS
IN database_name;
```

示例:

```
SHOW TRIGGERS IN edureka;
```

在上面的示例中，将显示名为 Edureka 的数据库中存在的所有触发器。

我们还看了插入前和插入后触发器的一些主要变体。我们已经在示例中看到了触发器。但是在表格的帮助下，让我们看看这到底是如何工作的。

我们已经了解了如何创建触发器，现在让我们了解触发器的两种变体，即插入前和插入后。为了实现它们，让我们创建一个包含各种列的学生表，如下所示:

```
CREATE TABLE Student(
studentID INT NOT NULL AUTO_INCREMENT,
FName VARCHAR(20),
LName VARCHAR(20),
Address VARCHAR(30),
City VARCHAR(15),
Marks INT,
PRIMARY KEY(studentID)
);
```

现在，如果我们执行这个查询，我们会得到下表。

![Tables - Triggers in SQL - Edureka](../Images/2f3804fafb2b7013a7f5deb9db2afc52.png)

让我们试着在插入 之前使用第一个变体，即

```
CREATE TRIGGER calculate
before INSERT 
ON student
FOR EACH ROW
SET new.marks = new.marks+100;
```

这里，当我们将数据自动插入学生表时，触发器将被调用。触发器会将 100 添加到学生列的分数列中。

现在让我们使用第二个变体，即在之后的*T1**插入**T5】*

为了使用这个变量，我们还需要一个表，即触发器存储结果的百分比。使用下面的代码创建百分比表。

```
create table Final_mark(
per int );
```

现在让我们使用 after insert 触发器

```
CREATE TRIGGER total_mark
after insert 
ON student
FOR EACH ROW
insert into Final_mark values(new.marks);
```

在这里，当我们向表中插入数据时， *total_mark 触发器*会将结果存储在 Final_mark 表中。

以上是关于触发器的操作，现在让我们继续，看看它的优点和缺点。

## **触发器的优缺点**

**优势**

*   强制数据库中存在的表上的**安全**批准
*   触发器提供了另一种方式来检查**数据的完整性**T3】
*   **冲抵无效**往来
*   触发器**处理来自数据库层的错误**
*   通常触发器可以用于**检查数据**表格中的变化
*   触发器提供了运行预定任务的另一种方式。使用触发器，我们不必等待预定事件的运行，因为触发器会在表中的数据发生变化之前或之后自动调用

**劣势** **劣势**

*   触发器只能提供扩展的**验证**，即不是所有类型的验证。对于简单的验证，您可以使用 NOT NULL、UNIQUE、CHECK 和 FOREIGN KEY 约束
*   触发器可能会增加数据库的**开销**
*   触发器可能很难**排除**故障，因为它们在数据库中自动执行，客户端应用程序可能看不到它们

这就把我们带到了 SQL 文章的结尾。我希望你理解了触发器的概念。

如果您希望了解更多关于 [MySQL](https://www.edureka.co/blog/what-is-mysql/) 的信息，并了解这款开源关系数据库，那么请查看我们的 [MySQL DBA 认证培训](https://www.edureka.co/mysql-dba)，该培训包含讲师指导的现场培训和真实项目体验。本培训将帮助您深入了解 MySQL，并帮助您掌握这门学科。

有问题要问我们吗？请在 SQL 中的这个触发器的评论部分提到它，我们将回复您。