# 了解 MongoDB 中的日志记录

> 原文:[https://www . edu reka . co/blog/understanding-journaling-in-MongoDB/](https://www.edureka.co/blog/understanding-journaling-in-mongodb/)

[//www.youtube.com/embed/s0LnwqIwMhE](//www.youtube.com/embed/s0LnwqIwMhE)

## **用 Mongod 写操作**工作

Mongod 主要在共享视图中托管内存中的写操作。之所以称之为共享，是因为它在实际磁盘中有内存映射。

例如，用户的数据文件保存在数据 dd 中，它有一个内存映射。在这里，它首先将所有数据推送到内存中，在指定的时间间隔后，它将数据刷新到内存中，这每 60 秒发生一次，用户在此过程中不受影响。

在这里，这个过程被称为无日志选项，这意味着在将数据从内存保存到磁盘或突然关机时有 60 秒的延迟，这意味着内存中的任何数据都可能无法检索。因此，日志在这里变得很重要。

**T3】**

mongod 进程开始时，可以观察到以下语句:

日志目录= D:Rana 2 自定义数据日志

这里，日志目录是数据目录中的子目录，默认情况下是启用的。

## **MongoDB 中的日志是什么？**T3】

在这个过程中，mongod 中发生一个写操作，然后在私有视图中创建更改。第一块是内存，第二块是“我的光盘”。在指定的时间间隔(称为“日志提交时间间隔”)之后，私有视图将这些操作写入日志目录(驻留在磁盘中)。

一旦日志提交发生，mongod 就将数据推送到共享视图中。作为该过程的一部分，它从共享视图写入实际的数据目录(因为该过程在后台发生)。基本优势是，我们的周期从 60 秒减少到 200 毫秒。

在任何时间点发生中断或闪存磁盘在最后 59 秒内保持不可用的情况下(记住日志目录/写操作中的现有数据)，当 mongod 下次启动时，它基本上会重放所有写操作日志并写入实际的数据目录。

## **它是如何工作的？**T3】

在这里，一旦提交发生，相同的操作在共享视图中重放，然后，60 秒后，闪盘发生。

闪存完成后，数据将被处理。这里的数据在日志目录中被标记为已处理，这意味着每 60 秒，它检查一次它已复制的数据和那些应该从日志中删除的数据。

使用日志就像使用日志，原因是它创建了一个写操作日志来增加持久性。日志记录是临时存储，这意味着它仅将写操作日志保持为日志目录中的挂起状态。此外，共享视图有数据，但日志目录有操作。

例如，如果用户在没有日志记录的情况下写入一些数据，那么无论写入了什么数据，其内存映射都会让用户知道数据写入的位置。

## **链接私人视图&共享视图**T3】

在提交发生后，它在日志目录中被标记为一个进程，并且为共享/私有视图的当前视图完成了另一个映射(没有数据共享)。

在图表中，所有蓝色项目都在 RAM(随机存取存储器)中，藏红花表示磁盘。

如果数据没有在数据目录中闪存，但是在数据目录中有写操作，那么 mongod 将重新处理写操作并将其应用到数据目录。

需要注意的重要一点是，在日志提交之前发生崩溃的情况下，在 200 毫秒内追加到的数据将会丢失。

*还要注意，在日志目录中，我们一直在写实际操作。*

在示例语句中，如 *'Db.class.insert'* 这是一个插入操作，数据在插入到类操作中。因此，类操作实际上并没有驻留，而是驻留了操作。

还必须注意的是，如果使用日志有延迟，它会影响性能。

也可以在后台将日志记录作为一个异步过程，而不在操作中以同步方式做任何事情。在生产中也推荐日志记录。

其次,“200 毫秒”的日志提交时间间隔是可配置的，可以在 3 到 300 毫秒之间的任何时间内启用“––日志提交时间间隔”,这完全取决于非运行要求(写入发生的频率以及希望在日志目录中写入的频率)。如果正在进行繁重的写操作，则建议使用更少的毫秒数。

另请注意，私有视图保存实际数据，因为私有视图是用共享视图映射的。这里的共享视图将它刷新到数据目录。

在这个过程中，我们获得的优势是，如果我们有服务器崩溃，没有可用的数据需要写入闪存，那么下一个重新启动 mongod 的服务器将检查日志目录进行恢复。它将在数据目录中恢复、重放和写入操作，然后启动。

有问题要问我们吗？在评论区提到它们，我们会给你回复。

**相关帖子:**

[SQL vs NoSQL 数据库](https://www.edureka.co/blog/sql-vs-nosql-db/)

[MongoDB](https://www.edureka.co/blog/videos/free-webinar-on-introduction-to-mongodb/)T5】简介

[开始您的 MongoDB 课程！](https://www.edureka.co/mongodb)